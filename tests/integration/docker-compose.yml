services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
      POSTGRES_DB: videowall
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 3s
      timeout: 3s
      retries: 30

  vw-mgmt-api:
    image: registry.local:5000/vw-mgmt-api:dev
    environment:
      DATABASE_URL: postgresql://postgres:postgres@postgres:5432/videowall
      POLICY_URL: http://vw-policy:8080
      AUDIT_URL: http://vw-audit:8080
      HEALTH_URL: http://vw-health:8080
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "8443:8443"

  vw-policy:
    image: registry.local:5000/vw-policy:dev
    ports:
      - "8081:8080"

  vw-audit:
    image: registry.local:5000/vw-audit:dev
    environment:
      DATABASE_URL: postgresql://postgres:postgres@postgres:5432/videowall
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "8082:8080"

  vw-health:
    image: registry.local:5000/vw-health:dev
    ports:
      - "8083:8080"
